<!DOCTYPE html>
<html>
<head>
<title>01-guia.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="instalaci%C3%B3n-desatendida-de-debian">Instalación desatendida de Debian</h1>
<ul>
<li><a href="#instalaci%C3%B3n-desatendida-de-debian">Instalación desatendida de Debian</a>
<ul>
<li><a href="#1-entorno">1. Entorno</a></li>
<li><a href="#2-preparaci%C3%B3n-da-iso">2. Preparación da ISO</a></li>
<li><a href="#3-personalizaci%C3%B3n-do-ficheiro-preseedcfg">3. Personalización do ficheiro preseed.cfg</a>
<ul>
<li><a href="#31-os-locales">3.1 Os locales:</a></li>
<li><a href="#32-teclado">3.2 Teclado:</a></li>
<li><a href="#33-configuraci%C3%B3n-de-rede">3.3 Configuración de rede:</a></li>
<li><a href="#34-usuario-root">3.4 Usuario root:</a></li>
<li><a href="#35-fuso-horario">3.5 Fuso horario:</a></li>
<li><a href="#36-particionado">3.6 Particionado:</a></li>
<li><a href="#37-configurando-apt">3.7 Configurando APT:</a></li>
</ul>
</li>
<li><a href="#4--xerar-a-imaxe">4.  Xerar a imaxe</a></li>
</ul>
</li>
<li><a href="#bibliobraf%C3%ADa">Bibliobrafía</a></li>
</ul>
<div style="page-break-after: always;"></div>
<h2 id="1-entorno">1. Entorno</h2>
<p>Neste caso precisaremos:</p>
<ul>
<li>
<p>MV con Xubuntu con 4GB de RAM e 4 CPUS.</p>
</li>
<li>
<p>Directorio compartido na MV cun cartafol coa ISO de Debian</p>
</li>
<li>
<p>Precisamos instalar os seguintes aplicativos: <code>genisoimage</code> e <code>xorriso</code></p>
<pre class="hljs"><code><div>sudo apt install genisoimage -y
sudo apt install xorriso -y
</div></code></pre>
</li>
</ul>
<p>Ficheiro de configuración Vagrantfile</p>
<pre class="hljs"><code><div>
Vagrant.configure(<span class="hljs-string">"2"</span>) <span class="hljs-keyword">do</span> <span class="hljs-params">|config|</span>
    config.vm.box = <span class="hljs-string">"acntech/xubuntu"</span>
    config.vm.hostname =<span class="hljs-string">"EX-Pressed"</span>
  
    config.vm.provider <span class="hljs-string">"virtualbox"</span> <span class="hljs-keyword">do</span> <span class="hljs-params">|vb|</span>
      vb.memory = <span class="hljs-string">"4048"</span>
      vb.cpus = <span class="hljs-string">"4"</span>
      vb.name = <span class="hljs-string">"EX-Pressed"</span>
      vb.gui=<span class="hljs-literal">true</span>
     <span class="hljs-keyword">end</span>
    
     config.vm.provision <span class="hljs-string">"shell"</span>, <span class="hljs-symbol">inline:</span> <span class="hljs-string">&lt;&lt;-SHELL
       sudo apt update
       sudo apt install xorriso -y
     SHELL</span>
  <span class="hljs-comment">#cartafois</span>
  config.vm.synced_folder <span class="hljs-string">"isos"</span>, <span class="hljs-string">"/home/vagrant/isos"</span>
  
  
  <span class="hljs-keyword">end</span>
</div></code></pre>
<div style="page-break-after: always;"></div>
<h2 id="2-preparaci%C3%B3n-da-iso">2. Preparación da ISO</h2>
<ol>
<li>
<p>Primeiro hai que <strong>descargar a imaxe de debian</strong> da páxina oficial (debian.org). Podes descargar directamente empregando o comando curl. Por exemplo:</p>
<pre class="hljs"><code><div>$ curl -<span class="hljs-comment">#LO https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/debian-11.6.0-amd64-netinst.iso</span>
</div></code></pre>
<p>Tamén podes descargar outras versións na web de <a href="https://cdimage.debian.org/debian-cd/current/amd64/">Debian</a> ou pasar a imaxe a máquina virtual empregando o cartafol compartido de <code>/home/vagrant/isos</code></p>
</li>
<li>
<p>Agora temos que  extraer os arquivos da imaxe e para elos volcaremos o contido no directorio <code>/isofiles</code> :</p>
<pre class="hljs"><code><div>$ xorriso -osirrox on  -indev debian-11.5.0-amd64-DVD-1.iso -extract / isofiles/
</div></code></pre>
<p><strong>NOTA:</strong> Podemos ter problemas cando traballamos no directorio compartido co host ( <code>/home/vagrant/isos</code>), nese caso realiza a operación en calquera directorio da MV, por exemplo en  <code>/home/vagrant/Desktop/practica</code> .</p>
<p><code>xorriso -osirrox on  -indev debian-11.5.0-amd64-DVD-1.iso -extract / /home/vagrant/Desktop/practica/isofiles/</code></p>
</li>
<li>
<p>Seguídamente hai que descargar a plantilla <code>preseed.cfg</code> dende este enderezo:</p>
<p><a href="https://www.debian.org/releases/stable/example-preseed.txt">https://www.debian.org/releases/stable/example-preseed.txt</a></p>
<pre class="hljs"><code><div>    $ curl -<span class="hljs-comment">#L https://www.debian.org/releases/stable/example-preseed.txt -o preseed.cfg</span>

    <span class="hljs-comment"># outra opción con wget</span>
    $ wget https://www.debian.org/releases/stable/example-preseed.txt
</div></code></pre>
</li>
</ol>
<div style="page-break-after: always;"></div>
<h2 id="3-personalizaci%C3%B3n-do-ficheiro-preseedcfg">3. Personalización do ficheiro preseed.cfg</h2>
<p>Neste punto temos que editar  plantilla <code>preseed.cfg</code> e para elo sempre será de utilidade consultar a documentación &quot; <a href="https://www.debian.org/releases/wheezy/amd64/apbs04.html.en"> Contents of the preconfiguration file</a>&quot;. Algúns elementos a destacar son os seguintes</p>
<h3 id="31-os-locales">3.1 Os locales:</h3>
<p>Configuración do idioma, país e «locale»</p>
<pre class="hljs"><code><div>d-i debian-installer/language string es   
d-i debian-installer/country string ES   
d-i debian-installer/locale string es_ES.UTF-8
</div></code></pre>
<h3 id="32-teclado">3.2 Teclado:</h3>
<p>Configuración do teclado.</p>
<pre class="hljs"><code><div>d-i keyboard-configuration/xkb-keymap select es
</div></code></pre>
<h3 id="33-configuraci%C3%B3n-de-rede">3.3 Configuración de rede:</h3>
<p>Calquera nome de host e de dominio que se obteñan por DHCP utilízanse antes que os valores aquí definidos. Por outra banda, definir os valores impide que se mostren as preguntas, mesmo se os valores proveñen de DHCP.</p>
<pre class="hljs"><code><div>d-i netcfg/get_hostname string debian10   
d-i netcfg/get_domain string localdomain
</div></code></pre>
<h3 id="34-usuario-root">3.4 Usuario root:</h3>
<p>Configuración do contrasinal de root e podemos incluir a clave en <strong>claro</strong> ou <strong>cifrado</strong>.</p>
<pre class="hljs"><code><div>d-i passwd/root-password-crypted password 4ab7772b776360f6303f50d70dae85ff 
</div></code></pre>
<p><strong>Para encriptar a contrasinal, dende o terminal executa:</strong><br>
<code>mkpasswd -m sha-512 'password'</code></p>
<p><strong>Usuario normal:</strong></p>
<pre class="hljs"><code><div>d-i passwd/user-fullname string alumno   
d-i passwd/username string alumno   
d-i passwd/user-password-crypted password $6$9boh2CWRDEyFNubd$aZUkxNhkQYm3Sjd8bNmwfrL5n.eISQgqwPJ4eTtmlAjfH7aTSsUzjtnY2ILseZUalpefSG609b/R3s44njZ800
</div></code></pre>
<h3 id="35-fuso-horario">3.5 Fuso horario:</h3>
<p>Podes consultar os valores válidos das zonas  <em>/usr/share/zoneinfo/</em> .</p>
<p><code>d-i time/zone string Europe/Madrid</code></p>
<h3 id="36-particionado">3.6 Particionado:</h3>
<p>Pódese elexir calquera das tres opcións para o particionado:</p>
<ul>
<li><strong>atomic</strong>: todos os arquivos nunha partición</li>
<li><strong>home</strong>:   separa a partición /home</li>
<li><strong>multi</strong>:  separar ás particións /home, /var e /tmp</li>
</ul>
<p><code>d-i partman-auto/choose_recipe select home</code></p>
<p><code>atomic</code> (todo na mesma partición), <code>home</code> ( <code>/home</code> separada) ou <code>multi</code> ( <code>/home, /var</code> e <code>/tmp</code> separadas)</p>
<h3 id="37-configurando-apt">3.7 Configurando APT:</h3>
<pre class="hljs"><code><div>d-i apt-setup/use_mirror boolean true  
d-i apt-setup/services-select multiselect security, updates   d-i apt-setup/security_host string security.debian.org   
d-i apt-setup/local0/repository string \   http://local.server/debian stable main   
d-i apt-setup/local0/comment string local server   
d-i apt-setup/local0/source boolean true   
d-i apt-setup/multiarch string i386
</div></code></pre>
<p>Selección de paquetes:<br>
<code>tasksel tasksel/first multiselect standard, xfce-desktop   d-i pkgsel/include string openssh-server build-essential 2</code></p>
<p>Envío de estadísticas:<br>
<code>popularity-contest popularity-contest/participate boolean false</code></p>
<div style="page-break-after: always;"></div>
<h2 id="4-xerar-a-imaxe">4.  Xerar a imaxe</h2>
<ol>
<li>Establecmos os permisos de escritura ao DIR <em>install.amd</em></li>
</ol>
<pre class="hljs"><code><div>$ chmod +w -R isofiles/install.amd/
</div></code></pre>
<ol start="2">
<li>Descompactamos a imaxe <em>initrd</em></li>
</ol>
<pre class="hljs"><code><div>$ gunzip isofiles/install.amd/initrd.gz

</div></code></pre>
<ol start="3">
<li>Agregamos o arquivo <strong>preseed.cfg</strong> a <strong>initrd</strong></li>
</ol>
<pre class="hljs"><code><div>$ <span class="hljs-built_in">echo</span> preseed.cfg | cpio -H newc -o -A -F isofiles/install.amd/initrd
</div></code></pre>
<ol start="4">
<li>Creamos de novo a imaxe initrd</li>
</ol>
<pre class="hljs"><code><div>$ gzip isofiles/install.amd/initrd

</div></code></pre>
<ol start="5">
<li>Quitamos o permiso de escritura ao DIR <strong>install.amd</strong></li>
</ol>
<pre class="hljs"><code><div>chmod -w -R isofiles/install.amd/
</div></code></pre>
<ol start="6">
<li><strong>Modificación dos parámetros do sistema de arrinque &quot;ISOLINUX&quot;</strong>
Debemos editar o ficheiro isolinux/isolinux.cfg e eliminar a liña default <strong>vesamenu.c32</strong> isto evitará que se mostre o menú de instalación de Debian.</li>
</ol>
<p>Outra alternativa é comentar o ficheiro coa liña <strong>vesamenu.c32</strong> .</p>
<p>Exemplo do ficheiro:</p>
<pre class="hljs"><code><div><span class="hljs-comment"># D-I config version 2.0</span>
<span class="hljs-comment"># search path for the c32 support libraries (libcom32, libutil etc.)</span>
path 
include menu.cfg
<span class="hljs-comment">#default vesamenu.c32</span>
prompt 0
timeout 0

</div></code></pre>
<ol start="7">
<li><strong>Modificación dos parámetros do arrique GRUB</strong>
Temos que editar o ficheiro boot/grub/grub.cfg e agregar as seguintes liñas as cales evitarán que se mostre o menú de instalación de Debian.</li>
</ol>
<pre class="hljs"><code><div>set timeout_style=hidden
set timeout=0
set default=1
</div></code></pre>
<ol start="8">
<li>Xeración do MD5 (md5sum.txt)</li>
</ol>
<pre class="hljs"><code><div>$ <span class="hljs-built_in">cd</span> isofiles/
$ chmod a+w md5sum.txt
$ md5sum `find -follow -<span class="hljs-built_in">type</span> f` &gt; md5sum.txt
$ chmod a-w md5sum.txt
</div></code></pre>
<ol start="9">
<li>Creación da ISO</li>
</ol>
<pre class="hljs"><code><div>$ <span class="hljs-built_in">cd</span> ..
$ chmod a+w isofiles/isolinux/isolinux.bin
$ genisoimage -r -J -b isolinux/isolinux.bin -c isolinux/boot.cat -no-emul-boot -boot-load-size 4 -boot-info-table -o preseed-debian-10.1.0-amd64-netinst.iso isofiles
</div></code></pre>
<h1 id="bibliobraf%C3%ADa">Bibliobrafía</h1>
<ul>
<li><a href="https://www.debian.org/releases/wheezy/amd64/apb.html.en">Appendix B. Automating the installation using preseeding
</a>
<ul>
<li><a href="https://www.debian.org/releases/wheezy/amd64/apbs04.html.en"> Contents of the preconfiguration file</a></li>
<li><a href="https://www.debian.org/releases/stable/amd64/apbs04.es.html">Contenidos del fichero de preconfiguración (para bullseye)</a></li>
</ul>
</li>
<li><a href="https://www.librebyte.net/despliegue-de-sistemas/como-instalar-debian-de-forma-automatica-o-desatendida/">¿Cómo instalar Debian de forma automática o desatendida?</a></li>
<li><a href="https://fainotimesma.es/2021/02/17/instalacion-desatendida-de-debian/">Instalación desatendida de Debian</a></li>
</ul>

</body>
</html>
